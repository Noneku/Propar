{% extends 'base.html.twig' %}

{% block title %}Hello operationDashBoardController!{% endblock %}

{% block body %}
<div class="container">
    <h1>Tableau de bord</h1>

    <!-- Ajoutez la case à cocher pour filtrer les opérations terminées -->
    <label for="toggle-completed-operations">Afficher les opérations terminées</label>
    <input type="checkbox" id="toggle-completed-operations">

    <div id="operations-table">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Prestation choisie</th>
                    <th>Client</th>
                    <th>Employé</th>
                    <th>Matricule</th>
                    <th>Date - Opération</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for operation in operations %}
                    {% set isCompleted = operation.isStatus() == 1 %}
                    <tr class="{% if isCompleted %}completed-operation{% endif %}" {% if isCompleted %}style="display: none;"{% endif %}>
                        <td>{{ operation.getId() }}</td>
                        <td>{{ operation.getDemande().getPrestation().getNom() }}</td>
                        <td>{{ operation.getDemande().getClient().getNom() ~ ' ' ~  operation.getDemande().getClient().getPrenom()}}</td>
                        <td>{{ operation.getEmploye().getNom() ~ ' ' ~ operation.getEmploye().getPrenom() }}</td>
                        <td>{{ operation.getEmploye().getMatricule() }}</td>
                        <td>{{ operation.getDateOperation()|date('Y-m-d H:i:s') }}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ path('app_operation_edit', {'id': operation.id}) }}" class="btn btn-primary bg-danger {% if isCompleted %}disabled{% endif %}">
                                    Modifier
                                </a>
                                <a href="{{ path('app_close_operation', {'id': operation.getDemande().getClient().getId(), 'id_operation': operation.getId()}) }}" class="btn btn-primary bg-danger finish-operation {% if isCompleted %}disabled{% endif %}" data-operation-id="{{ operation.id }}" {% if isCompleted %}disabled{% endif %}>
                                    Terminer
                                </a>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Inclusion du script JavaScript externe -->
<script src="{{ asset('js/terminer_operation.js') }}"></script>

{% endblock %}
